function modalOption1Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption1Callback&&modalOption1Callback(t)}function modalOption2Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption2Callback&&modalOption2Callback(t)}function modalOption3Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption3Callback&&modalOption3Callback(t)}function modalListItemClick(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalListItemCallback&&modalListItemCallback(t)}function modalInputKeyUpEvent(t){if("Enter"===t.key){const e=document.getElementById("modal-button1");if(!e||"none"===e.style.display)return;t.preventDefault(),e.click()}else if("Escape"===t.key||"Esc"===t.key){const e=document.getElementById("modal-button3");if(!e||"none"===e.style.display)return;t.preventDefault(),e.click()}}function setupModal(){const t=document.createElement("div");t.id="modal",document.body.appendChild(t);const e=document.createElement("div");e.id="modal-content",t.appendChild(e);const n=document.createElement("p");n.id="modal-text",e.appendChild(n);const i=document.createElement("input");i.id="modal-input",i.type="text",e.appendChild(i),i.addEventListener("keyup",modalInputKeyUpEvent);const l=document.createElement("label");l.id="modal-colour-label",l.for="modal-colour",e.appendChild(l);const o=document.createElement("input");o.type="color",o.id="modal-colour",e.appendChild(o);const a=document.createElement("fieldset");a.id="modal-list",e.appendChild(a);const d=document.createElement("div");d.id="modal-buttons",e.appendChild(d);const s=document.createElement("button");s.id="modal-button1",s.type="button",s.textContent="ERROR",s.addEventListener("click",modalOption1Click),d.appendChild(s);const c=document.createElement("button");c.id="modal-button2",c.type="button",c.textContent="ERROR",c.addEventListener("click",modalOption2Click),d.appendChild(c);const g=document.createElement("button");g.id="modal-button3",g.type="button",g.textContent="ERROR",g.addEventListener("click",modalOption3Click),d.appendChild(g)}function registerServiceWorker(){navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("controllerchange",function(){window.location.reload()}),navigator.serviceWorker.register("sw.min.js"))}function defaultSettings(){Settings.Highlight1="#CCCC00",Settings.Highlight2="#AA00CC",Settings.Highlight3="#00CCBB",Settings.Highlight4="#222222",Settings.Highlight5="#3BAF53",Settings.Highlight6="#4F73C2",Settings.Highlight7="#F20F19",Settings.Highlight8="#F79ACC",Settings.Highlight9="#808080",Settings.Highlight0="#F8C026",Settings.Menu="Open",Settings.Theme="System",Settings.Zoom="Fit"}function loadSettings(){defaultSettings();const t=localStorage.getItem(StoreName.Settings);if(t){const e=JSON.parse(t);e&&(e.Filters&&(e.Filters.Brightness&&(Settings.Filters.Brightness=e.Filters.Brightness),e.Filters.Contrast&&(Settings.Filters.Contrast=e.Filters.Contrast),e.Filters.Hue&&(Settings.Filters.Hue=e.Filters.Hue),e.Filters.Saturation&&(Settings.Filters.Saturation=e.Filters.Saturation)),e.Highlight1&&(Settings.Highlight1=e.Highlight1),e.Highlight2&&(Settings.Highlight2=e.Highlight2),e.Highlight3&&(Settings.Highlight3=e.Highlight3),e.Highlight4&&(Settings.Highlight4=e.Highlight4),e.Highlight5&&(Settings.Highlight5=e.Highlight5),e.Highlight6&&(Settings.Highlight6=e.Highlight6),e.Highlight7&&(Settings.Highlight7=e.Highlight7),e.Highlight8&&(Settings.Highlight8=e.Highlight8),e.Highlight9&&(Settings.Highlight9=e.Highlight9),e.Highlight0&&(Settings.Highlight0=e.Highlight0),e.Menu&&(Settings.Menu=e.Menu),e.Theme&&(Settings.Theme=e.Theme),e.Zoom&&(Settings.Zoom=e.Zoom))}}function saveSettings(){const t=JSON.stringify(Settings);localStorage.setItem(StoreName.Settings,t)}function setTheme(t){switch(t){case"Light":document.documentElement.className="theme-light";break;case"Dark":document.documentElement.className="theme-dark";break;case"System":default:document.documentElement.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-light"}}function themeChange(t){if("System"===Settings.Theme){const e=document.getElementsByTagName("html")[0];e.className=t.matches?"theme-dark":"theme-light"}}function addThemeListener(t){const e=window.matchMedia("(prefers-color-scheme: dark)");"addEventListener"in e&&e.addEventListener("change",t)}function downloadBlob(t,e){const n=document.createElement("a");n.rel="noopener",n.download=t,n.href=URL.createObjectURL(e),setTimeout(function(){URL.revokeObjectURL(n.href)},45e3),n.click()}function exportPng(t,e,n){const i=document.createElement("canvas"),l=i.getContext("2d"),o=new Image;o.onload=function(){i.width=o.width,i.height=o.height,n&&(l.fillStyle=n,l.rect(0,0,i.width,i.height),l.fill()),"imageSmoothingQuality"in l&&(l.imageSmoothingQuality="high"),l.drawImage(o,0,0),i.toBlob(function(e){downloadBlob(t,e)})},o.src="data:image/svg+xml;base64,"+btoa(e)}function exportSvg(t,e){const n=new Blob([e],{type:"image/svg+xml"});downloadBlob(t,n)}function createElementFromHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild}function getStringBetween(t,e,n,i){if(!t)return;if(-1===e)return;const l=t.indexOf(n,e);if(-1===l)return;const o=t.indexOf(i,l);return-1!==o?t.substring(l+1,o):void 0}function getFiltersCss(t,e,n,i){const l=(t/10).toFixed(1),o=(e/10).toFixed(1),a=n+"deg",d=(i/10).toFixed(1);return`brightness(${l}) contrast(${o}) hue-rotate(${a}) saturate(${d})`}function backOrHome(){window.history.length<=1||""===document.referrer?window.location.href="/":window.history.back()}function showModalDialog(t="ERROR",e=!1,n="",i="",l,o="",a,d="",s,c=!1,g=[],m,r=!1,h="",u){modalOption1Callback=l,modalOption2Callback=a,modalOption3Callback=s,modalListItemCallback=m,document.getElementById("modal-text").innerHTML=t;const p=document.getElementById("modal-input");p.value=n,p.style.display=e?"inline-block":"none";const y=document.getElementById("modal-list");for(;y.lastChild;)y.removeChild(y.lastChild);if(c){const t=32,e=27;for(const n of g){const i=document.createElement("button");i.value=n.value,i.textContent=n.label;let l=n.value;const o=new RegExp("(.*)\\(([0-9]+)x([0-9]+)\\)"),a=o.exec(l);if(0!==a.length){l=a[1];let n=a[2],o=a[3];if((n>t||o>t)&&(scale=Math.min(t/n,t/o),n*=scale,o*=scale),i.style.backgroundSize=`${n}px ${o}px`,n<t){const l=e-(t-n)/2;i.style.backgroundPositionX=`${l}px`}}i.style.backgroundImage=`url(${l})`,y.appendChild(i),i.addEventListener("click",modalListItemClick)}}y.style.display=c?"grid":"none";const f=document.getElementById("modal-colour-label"),C=document.getElementById("modal-colour");r&&(f.textContent=h,C.value=u||Colours[0]),f.style.display=r?"inline-block":"none",C.style.display=r?"inline-block":"none";const b=document.getElementById("modal-button1");b.textContent=i,b.style.display=i?"inline-block":"none";const S=document.getElementById("modal-button2");S.textContent=o,S.style.display=o?"inline-block":"none";const k=document.getElementById("modal-button3");k.textContent=d,k.style.display=d?"inline-block":"none",document.getElementById("modal").style.display="block",modalVisible=!0,e||!i||o||d||(document.activeElement.blur(),b.focus()),e&&(document.activeElement.blur(),p.focus())}function getModalInputText(){return document.getElementById("modal-input").value}function getModalColourValue(){return document.getElementById("modal-colour").value}function getHexForColour(t){const e=document.createElement("canvas").getContext("2d");return e.fillStyle=t,e.fillStyle}function isEmbedded(){try{return window.self!==window.top}catch{return!0}}const StoreName={Flags:"flags",Settings:"settings",MatrixSelection:"matrix-selection"},Mouse={Button:{Left:0,Middle:1,Right:2,Back:3,Forward:4},Buttons:{Left:1,Right:2,Middle:4,Back:8,Forward:16},Which:{Left:1,Middle:2,Right:3}},Settings={Filters:{Brightness:10,Contrast:10,Hue:0,Saturation:10},Highlight1:"",Highlight2:"",Highlight3:"",Highlight4:"",Highlight5:"",Highlight6:"",Highlight7:"",Highlight8:"",Highlight9:"",Highlight0:"",Menu:"",Theme:"",Zoom:""},isIOS=window.navigator.userAgent.includes("iPad")||window.navigator.userAgent.includes("iPhone");let modalVisible=!1,modalOption1Callback=void 0,modalOption2Callback=void 0,modalOption3Callback=void 0,modalListItemCallback=void 0;registerServiceWorker(),loadSettings(),setTheme(Settings.Theme),addThemeListener(themeChange);